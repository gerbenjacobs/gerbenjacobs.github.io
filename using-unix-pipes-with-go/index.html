<!doctype html><html lang=en class=h-100><head><meta charset=utf-8><meta name=description content="Built your own Unix tool that allows data to be piped via stdin and stdout"><meta name=viewport content="width=device-width,initial-scale=1"><link href=https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css rel=stylesheet integrity=sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65 crossorigin=anonymous><link rel=stylesheet type=text/css href=/css/style.css><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Nunito:wght@200&family=Permanent+Marker&display=swap" rel=stylesheet><link rel=author href=/humans.txt><meta property="og:url" content="https://blog.gerbenjacobs.nl/using-unix-pipes-with-go/"><meta property="og:type" content="website"><meta property="og:title" content="Using Unix pipes with Go"><meta property="og:description" content="Built your own Unix tool that allows data to be piped via stdin and stdout"><meta property="og:image" content="https://blog.gerbenjacobs.nl/img/6034711842_c3d1719f75_c.jpg"><meta name=twitter:card content="summary_large_image"><meta property="twitter:domain" content="blog.gerbenjacobs.nl"><meta property="twitter:url" content="https://blog.gerbenjacobs.nl/using-unix-pipes-with-go/"><meta name=twitter:title content="Using Unix pipes with Go"><meta name=twitter:description content="Built your own Unix tool that allows data to be piped via stdin and stdout"><meta name=twitter:image content="https://blog.gerbenjacobs.nl/img/6034711842_c3d1719f75_c.jpg"><meta itemprop=name content="Using Unix pipes with Go"><meta itemprop=description content="Built your own Unix tool that allows data to be piped via stdin and stdout"><meta itemprop=datePublished content="2024-10-06T12:00:00+02:00"><meta itemprop=dateModified content="2024-10-16T12:22:06+02:00"><meta itemprop=wordCount content="709"><meta itemprop=keywords content="Tech,Go,Unix,Tutorial,Open-Source"><script async src="https://www.googletagmanager.com/gtag/js?id=G-KKSLTF3X24"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-KKSLTF3X24")}</script><script src=/js/main.js></script><title>Using Unix pipes with Go | Gerben Jacobs</title></head><body class="d-flex flex-column h-100"><nav id=nav class="navbar navbar-expand-lg navbar-dark bg-dark"><div class=container-fluid><a class=navbar-brand href=/>Gerben Jacobs</a><ul class="navbar-nav d-flex mb-2 mb-lg-0"><li class=nav-item><a id=darkmode class="btn btn-primary" title="Toggle dark mode">🌓</a></li></ul></div></nav><div id=content class=container><div class="row justify-content-center"><div class="col-xl-6 col-lg-8 col-md-11"><article><header><h1>Using Unix pipes with Go</h1></header>📅
<time datetime=2024-10-06>Oct 6, 2024</time> &mdash;
🧮 709 words
&mdash; 🏷️
<a href=https://blog.gerbenjacobs.nl/tags/tech><span class="badge bg-secondary">tech</span></a>
<a href=https://blog.gerbenjacobs.nl/tags/go><span class="badge bg-secondary">go</span></a>
<a href=https://blog.gerbenjacobs.nl/tags/unix><span class="badge bg-secondary">unix</span></a>
<a href=https://blog.gerbenjacobs.nl/tags/tutorial><span class="badge bg-secondary">tutorial</span></a>
<a href=https://blog.gerbenjacobs.nl/tags/open-source><span class="badge bg-secondary">open-source</span></a><hr class=rainbow><strong>Table of contents</strong><nav id=TableOfContents><ul><li><a href=#-course>📒 Course</a></li><li><a href=#-pipes>🔩 Pipes</a></li><li><a href=#-reading-and-writing>📝 Reading and writing</a></li><li><a href=#-result>✔️ Result</a></li></ul></nav><hr class=rainbow><p><em>Header by <a href=https://www.flickr.com/photos/cogdog/6034711842/>Alan Levine CC BY 2.0</a></em></p><p>Go has made it easy to work with Unix operations, it comes with the platform-independent built-in package <code>os</code> to interface with the operating system.</p><p>They offer nice features such as <code>os.Stdin</code> and <code>os.Stdout</code>, wrappers of type <code>os.File</code> around the OS&rsquo;s common standard streams.</p><p>The <code>os/exec</code> package is also great. It allows you to run Unix-tools from within your Go application.</p><blockquote><p>Package exec runs external commands. It wraps os.StartProcess to make it easier to remap stdin and stdout, connect I/O with pipes, and do other adjustments.</p></blockquote><p>We however are only going to read and write from <em>standard out</em>.</p><h2 id=-course>📒 Course</h2><p>At work I wanted to teach some Go as well as show off cross-compiling.
Since the audience is a mix of developers and system engineers I figured I&rsquo;d make a CLI tool that touches on a few things.</p><blockquote><p>This course will show you how to make a Go binary that acts as a unix tool.</p><p>We will read data from <code>stdin</code>, convert it to our custom JSON model and push it through to <code>stdout</code>, completing the cycle.</p><p><em>This is a beginner to intermediate course for both Go and Unix, some things will be explained, but if you&rsquo;re unsure you should be able to autonomously search for the right information.</em></p></blockquote><p>If you want to do this course/tutorial for yourself, you can find it at <a href=https://github.com/gerbenjacobs/unix-pipe-course>https://github.com/gerbenjacobs/unix-pipe-course</a></p><p>⚠️ The rest of this post contains spoilers.</p><h2 id=-pipes>🔩 Pipes</h2><p>In case you&rsquo;re not familiar with piping, it allows you to combine multiple programs in a chain using the pipe-symbol &ldquo;<code>|</code>&rdquo; and in essence create a &lsquo;pipeline&rsquo;.</p><p>Data from one program gets sent on the &lsquo;stdout&rsquo; and back into the &lsquo;stdin&rsquo; for the next program.</p><p>You might have already used this unknowingly while pretty-printing a cURL response:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>curl -s https://dummyjson.com/test | jq
</span></span></code></pre></div><h2 id=-reading-and-writing>📝 Reading and writing</h2><p>Since <code>os.Stdin</code> is a <code>os.File</code> we can use a myriad of methods that deal with this.
Assuming we are in control of what the input is (i.e. don&rsquo;t expect 100GB dumps), we can use <code>io.ReadAll</code> to read the data straight into memory.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;io&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;os&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>data</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>io</span>.<span style=color:#a6e22e>ReadAll</span>(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stdin</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;failed to read data: %v&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Input: %#v | len(%d)&#34;</span>, string(<span style=color:#a6e22e>data</span>), len(<span style=color:#a6e22e>data</span>))
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>And that&rsquo;s <strong>literally</strong> it for the reading part.</p><p>We&rsquo;ve learned to use a <code>io.ReadAll</code> (which implements the <code>io.Reader</code> interface) in combination with <code>stdin</code>,
but for writing we&rsquo;ll need to use a <code>io.Writer</code>.</p><p>Since we know we&rsquo;re going to use JSON we can have a look at the <code>encoding/json</code> <a href=https://pkg.go.dev/encoding/json>package</a>.</p><p>You&rsquo;re probably familiar with <code>json.Marshal</code> but the package also comes with an <code>json.Encoder</code>,
that needs to be initialized with a <code>io.Writer</code> interface.</p><p>We can use the <code>os.Stdout</code> file descriptor for this, cause as you remember, it&rsquo;s a wrapper around <code>os.File</code>
and those adhere to the <code>io.Writer</code> interface.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;encoding/json&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;io&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;os&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Output</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Message</span> <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;message&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Length</span>  <span style=color:#66d9ef>int</span>    <span style=color:#e6db74>`json:&#34;len&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>data</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>io</span>.<span style=color:#a6e22e>ReadAll</span>(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stdin</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;failed to read data: %v&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>enc</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>NewEncoder</span>(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stdout</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>enc</span>.<span style=color:#a6e22e>Encode</span>(<span style=color:#a6e22e>Output</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Message</span>: string(<span style=color:#a6e22e>data</span>),
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Length</span>:  len(<span style=color:#a6e22e>data</span>),
</span></span><span style=display:flex><span>	})
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;failed to encode json: %v&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>In this example we pretend there&rsquo;s a reason for us to create a custom JSON object with the special <code>message</code> and <code>len</code> names.</p><p>We create a <code>json.Encoder</code> where the output stream is <code>os.Stdout</code> and we call <code>Encode()</code> with an inlined <code>Output</code>-struct.</p><p>We make sure we typecast our <code>[]byte</code> data as &lsquo;string&rsquo; and in case there are no errors, we have succesfully written to &lsquo;standard out&rsquo;.</p><h2 id=-result>✔️ Result</h2><p>When piping &ldquo;Hello World&rdquo; to our program using <code>echo</code> and outputting our work to <code>jq</code> (a pretty-printer for JSON), we will get the following.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>echo -n <span style=color:#e6db74>&#34;Hello World&#34;</span> | go run main.go | jq
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;message&#34;</span>: <span style=color:#e6db74>&#34;Hello World&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;len&#34;</span>: <span style=color:#ae81ff>11</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Now if you build your Go program and call it &lsquo;json_encoder&rsquo; it will look even more like you&rsquo;re doing regular ol&rsquo; Unix piping!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>cat important_business.txt | json_encoder | jq
</span></span></code></pre></div><p>Congratulations! Your Go program is now pipable, you&rsquo;re a pipe in a bigger Unix pipeline.</p><p><em>If you want to know more about <strong>cross-compiling</strong> check <a href=https://github.com/gerbenjacobs/unix-piping-course/tree/main/step3>step 3 of the course</a>.</em></p></article><hr class=rainbow><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//gerbenjacobs.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div><div class="row justify-content-center"><div class="col-xl-6 col-lg-8 col-md-11"><div class=row><div class=col-md-6><div class=card><img loading=lazy src=https://blog.gerbenjacobs.nl/img/Firefly%20A%20set%20of%20tools%20and%20pipelines%20together%20with%20stock%20charts%2038630.jpg class="card-img-top card-img-height" alt="fin: A Trading212 aggregator tool (for Yahoo)"><div class=card-body><span class=card-title title="fin: A Trading212 aggregator tool (for Yahoo)">fin: A Trading212 aggregator...</span></div><div class=card-footer><a href=https://blog.gerbenjacobs.nl/fin-trading212-aggregator-tool/ class="btn btn-primary">&#171; Next</a></div></div></div><div class=col-md-6><div class=card><img loading=lazy src=https://blog.gerbenjacobs.nl/img/home-bg.jpg class="card-img-top card-img-height" alt="Social Media Detox"><div class=card-body><span class=card-title title="Social Media Detox">Social Media Detox</span></div><div class="card-footer text-end"><a href=https://blog.gerbenjacobs.nl/social-media-detox/ class="btn btn-primary">Previous &#187;</a></div></div></div></div><div class=row><div class=col>Find any post in the <a href=/posts/archive/>archive</a>.</div></div></div></div></div><footer class="footer mt-4 py-3 bg-light rainbow" id=footer><p>Copyright &copy; 2024 Gerben Jacobs</p><a href=/index.xml><span class="badge p-1 footer-social" style=border-color:orange><img src=/img/social/rss.svg alt=RSS>
</span></a><a href=https://twitter.com/gerbenjacobs><span class="badge p-1 footer-social" style=border-color:#1da1f2><img src=/img/social/twitter.svg alt=Twitter>
</span></a><a href=https://github.com/gerbenjacobs><span class="badge p-1 footer-social" style=border-color:#181717><img src=/img/social/github.svg alt=GitHub>
</span></a><a href=https://todon.nl/@gerben rel=me><span class="badge p-1 footer-social" style=border-color:#6364ff><img src=/img/social/mastodon.svg alt=Mastodon>
</span></a><a href=https://linkedin.com/in/gerbenjacobs><span class="badge p-1 footer-social" style=border-color:#0a66c2><img src=/img/social/linkedin.svg alt=LinkedIn></span></a></footer><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4344810300258970" crossorigin=anonymous></script><button class=btn id=btn-back-to-top>☝️</button></body></html>