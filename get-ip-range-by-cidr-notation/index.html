<!doctype html><html lang=en class=h-100><head><meta charset=utf-8><meta name=description content="Calculate the lowest and highest IP in a range by giving a (incomplete) CIDR notation string in PHP"><meta name=viewport content="width=device-width,initial-scale=1"><link href=https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css rel=stylesheet integrity=sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65 crossorigin=anonymous><link rel=stylesheet type=text/css href=/css/style.css><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Nunito:wght@200&family=Permanent+Marker&display=swap" rel=stylesheet><meta property="og:url" content="https://blog.gerbenjacobs.nl/get-ip-range-by-cidr-notation/"><meta property="og:type" content="website"><meta property="og:title" content="Get IP range by CIDR notation"><meta property="og:description" content="Calculate the lowest and highest IP in a range by giving a (incomplete) CIDR notation string in PHP"><meta property="og:image" content="https://blog.gerbenjacobs.nl/img/post-bg-01.jpg"><meta name=twitter:card content="summary_large_image"><meta property="twitter:domain" content="blog.gerbenjacobs.nl"><meta property="twitter:url" content="https://blog.gerbenjacobs.nl/get-ip-range-by-cidr-notation/"><meta name=twitter:title content="Get IP range by CIDR notation"><meta name=twitter:description content="Calculate the lowest and highest IP in a range by giving a (incomplete) CIDR notation string in PHP"><meta name=twitter:image content="https://blog.gerbenjacobs.nl/img/post-bg-01.jpg"><meta itemprop=name content="Get IP range by CIDR notation"><meta itemprop=description content="Calculate the lowest and highest IP in a range by giving a (incomplete) CIDR notation string in PHP"><meta itemprop=datePublished content="2012-11-21T12:00:00+00:00"><meta itemprop=dateModified content="2012-11-21T12:00:00+00:00"><meta itemprop=wordCount content="258"><meta itemprop=keywords content="tech,php,"><script async src="https://www.googletagmanager.com/gtag/js?id=G-KKSLTF3X24"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-KKSLTF3X24",{anonymize_ip:!1})}</script><title>Get IP range by CIDR notation | Gerben Jacobs</title></head><body class="d-flex flex-column h-100"><nav id=nav class="navbar navbar-expand-lg navbar-dark bg-dark"><div class=container-fluid><a class=navbar-brand href=/>Gerben Jacobs</a></div></nav><div id=content class=container><div class="row justify-content-center"><div class="col-xl-6 col-lg-8 col-md-11"><article><header><h1>Get IP range by CIDR notation</h1></header>üìÖ
<time datetime=2012-11-21>Nov 21, 2012</time> &mdash;
üßÆ 258 words
&mdash; üè∑Ô∏è
<a href=https://blog.gerbenjacobs.nl/tags/tech><span class="badge bg-secondary">tech</span></a>
<a href=https://blog.gerbenjacobs.nl/tags/php><span class="badge bg-secondary">php</span></a><hr class=rainbow><p>I wanted to get the IPv4 range of a WHOIS record provided by
<a title="Latin America and Caribbean Internet Address Registry" href=http://www.lacnic.net/en/web/lacnic/inicio>LACNIC</a>,
because unlike other <a title="Regional Internet Registries" href=https://en.wikipedia.org/wiki/Regional_Internet_registry>RIRs</a>
they don't supply you with the range, but with just
a <a title="Classless Inter-Domain Routing on Wikipedia" href=https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing>CIDR notation</a>.</p><p>To make matters worse, they give 'incomplete' net numbers. The only working "CIDR to IP range" function I could find didn't accept it, so I had to sprinkle some <em>magic</em>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>$ipdata <span style=color:#f92672>=</span> <span style=color:#a6e22e>explode</span>(<span style=color:#e6db74>&#39;/&#39;</span>, <span style=color:#a6e22e>ltrim</span>($incomplete_cidr_notation, <span style=color:#e6db74>&#39;0&#39;</span>));
</span></span><span style=display:flex><span>$dotcount <span style=color:#f92672>=</span> <span style=color:#a6e22e>substr_count</span>($ipdata[<span style=color:#ae81ff>0</span>], <span style=color:#e6db74>&#39;.&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> ($dotcount <span style=color:#f92672>!=</span> <span style=color:#ae81ff>3</span>) {
</span></span><span style=display:flex><span>    $ipdata[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>.=</span> <span style=color:#a6e22e>str_repeat</span>(<span style=color:#e6db74>&#39;.0&#39;</span>, (<span style=color:#ae81ff>3</span><span style=color:#f92672>-</span>$dotcount));
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>$finalip <span style=color:#f92672>=</span> <span style=color:#a6e22e>sprintf</span>(<span style=color:#e6db74>&#39;%s/%s&#39;</span>, $ipdata[<span style=color:#ae81ff>0</span>], $ipdata[<span style=color:#ae81ff>1</span>]);
</span></span><span style=display:flex><span>$range <span style=color:#f92672>=</span> <span style=color:#a6e22e>cidr_conv</span>($finalip);
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>The final <code>cidr_conv()</code> is written by someone unknown in 2003 and can be
<a title=cidr_conv() href=https://www.php.net/manual/en/ref.network.php#30910>found in the PHP.net comments of the Network functions page</a>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>cidr_conv</span>($cidr_address) {
</span></span><span style=display:flex><span>    $first <span style=color:#f92672>=</span> <span style=color:#a6e22e>substr</span>($cidr_address, <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>strpos</span>($cidr_address, <span style=color:#e6db74>&#34;/&#34;</span>));
</span></span><span style=display:flex><span>    $netmask <span style=color:#f92672>=</span> <span style=color:#a6e22e>substr</span>(<span style=color:#a6e22e>strstr</span>($cidr_address, <span style=color:#e6db74>&#34;/&#34;</span>), <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $first_bin <span style=color:#f92672>=</span> <span style=color:#a6e22e>str_pad</span>(<span style=color:#a6e22e>decbin</span>(<span style=color:#a6e22e>ip2long</span>($first)), <span style=color:#ae81ff>32</span>, <span style=color:#e6db74>&#34;0&#34;</span>, <span style=color:#a6e22e>STR_PAD_LEFT</span>);
</span></span><span style=display:flex><span>    $netmask_bin <span style=color:#f92672>=</span> <span style=color:#a6e22e>str_pad</span>(<span style=color:#a6e22e>str_repeat</span>(<span style=color:#e6db74>&#34;1&#34;</span>, (<span style=color:#a6e22e>integer</span>)$netmask), <span style=color:#ae81ff>32</span>, <span style=color:#e6db74>&#34;0&#34;</span>, <span style=color:#a6e22e>STR_PAD_RIGHT</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> ($i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; $i <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>32</span>; $i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ($netmask_bin[$i] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;1&#34;</span>)
</span></span><span style=display:flex><span>            $last_bin <span style=color:#f92672>.=</span> $first_bin[$i];
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>            $last_bin <span style=color:#f92672>.=</span> <span style=color:#e6db74>&#34;1&#34;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $last <span style=color:#f92672>=</span> <span style=color:#a6e22e>long2ip</span>(<span style=color:#a6e22e>bindec</span>($last_bin));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>array</span>($first, $last);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>So you can enter <code>190.151.192/18</code> as <code>$incomplete_cidr_notation</code> and get</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>(
</span></span><span style=display:flex><span>    [<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=&gt;</span> <span style=color:#ae81ff>190.151</span><span style=color:#f92672>.</span><span style=color:#ae81ff>192.0</span>
</span></span><span style=display:flex><span>    [<span style=color:#ae81ff>1</span>] <span style=color:#f92672>=&gt;</span> <span style=color:#ae81ff>190.151</span><span style=color:#f92672>.</span><span style=color:#ae81ff>255.255</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>But even if you enter <code>17/8</code> (or with a leading zero, straight out of IANAs IP allocation file) it will work, and you'll get in this case Apple's IP range</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>(
</span></span><span style=display:flex><span>    [<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=&gt;</span> <span style=color:#ae81ff>17.0</span><span style=color:#f92672>.</span><span style=color:#ae81ff>0.0</span>
</span></span><span style=display:flex><span>    [<span style=color:#ae81ff>1</span>] <span style=color:#f92672>=&gt;</span> <span style=color:#ae81ff>17.255</span><span style=color:#f92672>.</span><span style=color:#ae81ff>255.255</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><hr><p><small><strong>Update:</strong> Since this article is getting quite a few hits and when I read this back it seemed kinda confusing, I've recreated this a bit better as a Gist.</small></p><script src=https://gist.github.com/gerbenjacobs/6973722.js></script></article><hr class=rainbow><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//gerbenjacobs.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div><div class="row justify-content-center"><div class="col-xl-6 col-lg-8 col-md-11"><div class=row><div class=col-md-6><div class=card><img src=https://blog.gerbenjacobs.nl/img/flickr-theonewithout-norway-shoes.png class="card-img-top card-img-height" alt="Quickly create an empty stdClass object in PHP"><div class=card-body><span class=card-title title="Quickly create an empty stdClass object in PHP">Quickly create an empty...</span></div><div class=card-footer><a href=https://blog.gerbenjacobs.nl/quickly-create-an-empty-stdclass-object-in-php/ class="btn btn-primary">&#171; Next</a></div></div></div><div class=col-md-6><div class=card><img src=https://blog.gerbenjacobs.nl/img/post-bg-05.jpg class="card-img-top card-img-height" alt="Perfect separator for Shoutcast 7.html file"><div class=card-body><span class=card-title title="Perfect separator for Shoutcast 7.html file">Perfect separator for...</span></div><div class="card-footer text-end"><a href=https://blog.gerbenjacobs.nl/perfect-separator-for-shoutcast-7.html-file/ class="btn btn-primary">Previous &#187;</a></div></div></div></div><div class=row><div class=col>Find any post in the <a href=/posts/archive/>archive</a>.</div></div></div></div></div><footer class="footer mt-4 py-3 bg-light rainbow" id=footer><p>Copyright &copy; 2022 Gerben Jacobs</p><a href=/index.xml><span class="badge p-1 footer-social" style=border-color:orange><img src=/img/social/rss.svg alt=RSS></span></a>
<a href=https://twitter.com/gerbenjacobs><span class="badge p-1 footer-social" style=border-color:#1da1f2><img src=/img/social/twitter.svg alt=Twitter></span></a>
<a href=https://github.com/gerbenjacobs><span class="badge p-1 footer-social" style=border-color:#181717><img src=/img/social/github.svg alt=GitHub></span></a>
<a href=https://todon.nl/@gerben rel=me><span class="badge p-1 footer-social" style=border-color:#6364ff><img src=/img/social/mastodon.svg alt=Mastodon></span></a>
<a href=https://linkedin.com/in/gerbenjacobs><span class="badge p-1 footer-social" style=border-color:#0a66c2><img src=/img/social/linkedin.svg alt=LinkedIn></span></a></footer><script>let cards=document.querySelectorAll(".card"),buttons=document.querySelectorAll(".btn-primary"),listgroups=document.querySelectorAll(".list-group-item");const prefersDarkScheme=window.matchMedia("(prefers-color-scheme: dark)");if(prefersDarkScheme.matches){document.body.classList.add("dark-theme");for(let e of cards)e.classList.add("text-bg-dark");for(let e of buttons)e.classList.add("btn-secondary"),e.classList.remove("btn-primary");for(let e of listgroups)e.classList.add("list-group-item-dark")}else{document.body.classList.remove("dark-theme");for(let e of cards)e.classList.remove("text-bg-dark");for(let e of buttons)e.classList.remove("btn-secondary"),e.classList.add("btn-primary");for(let e of listgroups)e.classList.remove("list-group-item-dark")}</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4344810300258970" crossorigin=anonymous></script></body></html>